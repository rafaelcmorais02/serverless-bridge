functions:
  api:
    handler: wsgi_handler.handler
    layers:
      - Ref: ${file(config.json):stages.${opt:stage, 'local'}.layer}
    events:
      - http:
          path: /
          method: ANY
          cors: true
      - http:
          path: /{proxy+}
          method: ANY
          cors: true
    environment:
      POSTGRES_DB: ${ssm(raw):${file(config.json):project_name}-${self:provider.stage}-POSTGRES_DB}
      POSTGRES_USER: ${ssm(raw):${file(config.json):project_name}-${self:provider.stage}-POSTGRES_USER}
      POSTGRES_PASSWORD: ${ssm(raw):${file(config.json):project_name}-${self:provider.stage}-POSTGRES_PASSWORD}
      POSTGRES_HOST: ${ssm(raw):${file(config.json):project_name}-${self:provider.stage}-POSTGRES_HOST}
      POSTGRES_PORT: ${ssm(raw):${file(config.json):project_name}-${self:provider.stage}-POSTGRES_PORT}
      DJANGO_SETTINGS_MODULE: ${ssm(raw):${file(config.json):project_name}-${self:provider.stage}-DJANGO_SETTINGS_MODULE}
      SECRET_KEY: ${ssm(raw):${file(config.json):project_name}-${self:provider.stage}-SECRET_KEY}
      ALLOWED_HOSTS: ${ssm(raw):${file(config.json):project_name}-${self:provider.stage}-ALLOWED_HOSTS}
